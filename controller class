package org.telusko.ticketbookingapi.rest;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.telusko.ticketbookingapi.model.Passenger;
import org.telusko.ticketbookingapi.model.Ticket;
import org.telusko.ticketbookingapi.service.ITicketService;

@RestController
@RequestMapping("api/book-ticket")
@Tag(name="TicketBookingApi",description="There are 2 apis one will accept Passenger info and genert ticket number and other generet ticket number ")
public class TicketController {
    @Autowired
    private ITicketService service;

    @PostMapping("/get-ticketNumber")
    @Operation(summary="POST Operation",description="This API will accept Passenger info and Generate Ticket number")
    public ResponseEntity<Integer> registerPassenger(@RequestBody  Passenger passenger){

        Passenger pass=service.registerPassenger(passenger);

        Integer ticketNumber = pass.getPid();

        return new  ResponseEntity<Integer>(ticketNumber, HttpStatus.CREATED);

    }
    @GetMapping("/get-ticketNumber/{ticketNumber}")
    @Operation(summary="GET  Operation",description="This API will accept Passenger info and Generate Ticket number and generet full ticket ")
    public ResponseEntity<Ticket> getTicket(@PathVariable("ticketNumber")Integer ticketNumber){

        Passenger passenger = service.fetchPassengerInfo(ticketNumber);
        Ticket ticket=new Ticket();
        ticket.setTicketNumber(passenger.getPid());
        ticket.setName(passenger.getName());
        ticket.setArrival(passenger.getArrival());
        ticket.setDateOfJourney(passenger.getDateOfJourney());
        ticket.setStatus("confirmed");
        ticket.setTicketPrice(890.33);

        return new  ResponseEntity<Ticket>(ticket,HttpStatus.OK);

    }

}
